# UI変更まとめ

更新日: 2026-02-22

## 対象ファイル
- `pc-server/app/ui_template.html`
- `pc-server/app/main.py`（UIが利用するAPIの挙動変更）
- `pc-server/app/prompt_gen.py`（栄養素取得の日付対応）
- `pc-server/app/nutrition.py`（サプリ名の日本語化）

## 1. フォントと文字化け対応
- UIフォントを `Noto Sans JP` に変更。
- 日本語表示の読みやすさを改善し、文字化けが出にくい構成に修正。

## 2. サプリ名の日本語化
- サプリ表示名を日本語へ統一。
  - `protein` → `ザバス ミルクプロテイン 脂肪0 キャラメル風味 200ml`
  - `vitamin_d` → `ビタミンD3 2000IU（ソフトジェル）`
  - `multivitamin` → `スーパーマルチビタミン＆ミネラル`
  - `fish_oil` → `スーパーフィッシュオイル`
- UI側でも `alias` ベースの日本語ラベルマップを持ち、旧データや英語ラベル混在時も日本語で表示するよう対応。
- 既存ログ読み出し時も `alias` があれば最新カタログラベルに正規化。

## 3. 栄養素グラフ（400対策 + 日付連動）
- `food-date` の選択日付を `/api/nutrients/targets` にクエリで渡すよう変更。
- 日付は `YYYY-MM-DD` 形式に正規化して送信。
- 日付が不正な場合は `date` クエリを送らずフォールバック。
- APIエラー時に `status + detail` を画面表示するよう変更（原因特定しやすくするため）。

## 4. 栄養素APIの改善
- `/api/nutrients/targets` に `date` クエリ対応を追加。
- プロフィール未設定でもデフォルト値で計算可能にし、初期状態で `400` になりにくい挙動へ変更。
- `prompt_gen.calc_nutrient_targets(...)` を `local_date` 指定対応にし、指定日の実績集計が可能に。

## 5. 日/週/月の全体切替
- 画面上部に期間スイッチ（`日` / `週` / `月`）を追加。
- 期間に応じて以下を連動更新:
  - ホームの見出し（今日/週次/月次サマリー）
  - ホーム指標（単日値 or 期間平均/期間合計）
  - 健康チャートの表示期間
    - 日次: 体重等14日、活動7日
    - 週次: 体重等30日、活動28日
    - 月次: 体重等90日、活動60日
  - AIタブ（プロンプト生成タイプ、履歴フィルタ）

## 6. ひとことアドバイス
- ホームに「💡 ひとことアドバイス」カードを追加。
- 睡眠、歩数、カロリー収支、体重トレンドをもとに短い助言を自動表示。
- データ不足時はフォールバック文言を表示。

## 7. 運用メモ
- 変更反映時はブラウザを `Ctrl+F5` でハードリロード推奨。
- サーバー再起動時は `API_KEY` 環境変数を付けて起動すること。

